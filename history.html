<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Swapey DEX | History</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  font-family:'Luckiest Guy', cursive;
  color:white;
  text-align:center;
  background:#16002d;
  overflow-x:hidden;
}
#ticker {
  position:fixed; top:0; width:100%; background:#1a0033; color:#40E0D0;
  padding:6px; font-weight:bold; font-family:'Luckiest Guy', cursive;
  overflow:hidden; z-index:11; text-align:center;
}

/* ----- Top-right Phantom & Back ----- */
#top-right {
  position:fixed; top:12px; right:12px;
  display:flex; align-items:center; gap:10px; z-index:12;
}
#top-right img {
  width:40px; cursor:pointer; border:3px solid red; border-radius:50%;
  transition: all 0.3s ease;
}
#top-right img.connected { border-color:lime; }
#top-right a.btn-back {
  background: linear-gradient(135deg,#40E0D0,#8F5BFF);
  color:white; padding:10px 18px; border-radius:16px;
  text-decoration:none; font-weight:bold;
  transition:all 0.2s;
}
#top-right a.btn-back:hover { transform:scale(1.1); }

/* ----- Wallet dashboard ----- */
#wallet-dashboard {
  position:fixed; top:70px; right:12px; width:260px;
  padding:12px; background: rgba(64,224,208,0.1);
  border-radius:16px; text-align:left;
  box-shadow:0 0 20px #40E0D0,0 0 40px #8F5BFF;
  font-size:0.9rem; z-index:11;
}
#wallet-balance { margin-bottom:6px; }
#wallet-tokens { max-height:280px; overflow-y:auto; }

/* ----- Header ----- */
header { padding:80px 20px 20px; position:relative; z-index:1; }
header img { width:520px; max-width:92%; margin-bottom:20px; }
h1 { font-size:3.4rem; margin:10px 0; }
p { font-size:1.2rem; color:#ffffffcc; max-width:720px; margin:auto; }

/* ----- Swap history table ----- */
.history-table { margin:40px auto; width:90%; max-width:800px; border-collapse:collapse; z-index:1; }
.history-table th, .history-table td {
  border:1px solid #40E0D0; padding:10px; text-align:center;
}
.history-table th { background:linear-gradient(135deg,#40E0D0,#8F5BFF); font-weight:bold; }

/* ----- Footer ----- */
footer { margin:40px 0; font-size:0.75rem; opacity:0.6; text-align:center; }
</style>
</head>
<body>

<div id="ticker">Loading crypto prices...</div>

<div id="top-right">
  <a href="index.html" class="btn-back">Home</a>
  <img id="phantom-logo" src="phantom-logo.png" onclick="togglePhantom()" alt="Phantom"/>
</div>

<div id="wallet-dashboard">
  <div id="wallet-balance"></div>
  <div id="wallet-tokens"></div>
</div>

<header>
  <img src="swapey-logo.png" alt="Swapey Logo"/>
  <h1>Swapey DEX History</h1>
  <p>Track your past swaps and wallet balances.</p>
</header>

<table class="history-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>From</th>
      <th>To</th>
      <th>Amount</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="history-body">
    <tr><td colspan="5">No swaps yet.</td></tr>
  </tbody>
</table>

<footer>Swapey is decentralized. Use at your own risk.</footer>

<script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@solana/spl-token-registry@0.2.10/dist/index.iife.js"></script>
<script>
// ----- Phantom Wallet -----
let phantomConnected=false;
const phantomLogo=document.getElementById("phantom-logo");

async function togglePhantom(){
  if(!phantomConnected){
    if(window.solana && window.solana.isPhantom){
      const resp = await window.solana.connect();
      phantomConnected=true;
      phantomLogo.classList.add("connected");
      const pubKey=resp.publicKey;
      const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
      const solBalance=await connection.getBalance(pubKey);
      document.getElementById("wallet-balance").innerText="SOL: "+(solBalance/1e9).toFixed(4);

      // SPL tokens
      const tokenList = await new TokenListProvider().resolve();
      const tokenMap = tokenList.filter(t=>t.chainId===101);
      const walletTokensDiv=document.getElementById("wallet-tokens");
      walletTokensDiv.innerHTML="<ul>";
      for(const token of tokenMap){
        try{
          const tokenPubKey = new solanaWeb3.PublicKey(token.address);
          const tokenAccounts = await connection.getTokenAccountsByOwner(pubKey,{mint:tokenPubKey});
          let balance = 0;
          if(tokenAccounts.value.length>0){
            const accountInfo = await connection.getParsedAccountInfo(tokenAccounts.value[0].pubkey);
            balance = accountInfo.value.data.parsed.info.tokenAmount.uiAmount || 0;
          }
          walletTokensDiv.innerHTML+=`<li>${token.symbol}: ${balance}</li>`;
        } catch(e){ console.error(token.symbol,e); }
      }
      walletTokensDiv.innerHTML+="</ul>";
    } else alert("Phantom not detected");
  } else {
    phantomConnected=false;
    phantomLogo.classList.remove("connected");
    document.getElementById("wallet-balance").innerText="";
    document.getElementById("wallet-tokens").innerHTML="";
  }
}

// ----- CoinGecko Ticker -----
async function updateTicker(){
  const resp=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd");
  const data=await resp.json();
  document.getElementById("ticker").innerText = 
    `BTC: $${data.bitcoin.usd} | ETH: $${data.ethereum.usd} | SOL: $${data.solana.usd}`;
}
updateTicker();
setInterval(updateTicker,10000);

// ----- Placeholder Swap History -----
const historyBody=document.getElementById("history-body");
const swapHistory=[
  {date:"2026-01-10", from:"SOL", to:"USDC", amount:"12.5", status:"Success"},
  {date:"2026-01-12", from:"USDC", to:"SOL", amount:"100", status:"Pending"}
];

function loadHistory(){
  historyBody.innerHTML="";
  swapHistory.forEach(s=>{
    const row=document.createElement("tr");
    row.innerHTML=`<td>${s.date}</td><td>${s.from}</td><td>${s.to}</td><td>${s.amount}</td><td>${s.status}</td>`;
    historyBody.appendChild(row);
  });
}
loadHistory();
</script>
</body>
</html>
