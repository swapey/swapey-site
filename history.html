<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Swapey DEX | History</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  font-family:'Luckiest Guy', cursive;
  color:white;
  background:#16002d;
  overflow-x:hidden;
  text-align:center;
}

/* ----- Top bar ----- */
#top-bar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:6px 12px;
  background:#1a0033;
  font-weight:bold;
  font-family:'Luckiest Guy', cursive;
  position:fixed;
  top:0;
  width:100%;
  z-index:12;
}
#top-bar #phantom-btn {
  position:relative;
  cursor:pointer;
  border-radius:50%;
  width:44px;
  height:44px;
  display:flex;
  justify-content:center;
  align-items:center;
  transition:all 0.2s;
}
#top-bar #phantom-btn.connected { box-shadow:0 0 0 3px #00ff80; }
#top-bar #phantom-btn.disconnected { box-shadow:0 0 0 3px #ff3b3b; }
#top-bar #phantom-btn img { width:32px; height:32px; }

/* ----- Wallet dashboard ----- */
#wallet-dashboard { margin-top:60px; max-width:300px; margin-left:auto; margin-right:auto; padding:12px; background: rgba(64,224,208,0.1); border-radius:16px; box-shadow:0 0 20px #40E0D0,0 0 40px #8F5BFF; text-align:left; font-size:0.9rem; }
#wallet-address, #wallet-sol { margin-bottom:6px; }
#wallet-tokens { max-height:400px; overflow-y:auto; }

/* ----- Header ----- */
header { padding:80px 20px 20px; }
h1 { font-size:3rem; margin:10px 0; }
p { font-size:1.1rem; color:#ffffffcc; max-width:720px; margin:auto; }

/* ----- Back button ----- */
#back-btn {
  margin:20px auto;
  display:inline-block;
  background: linear-gradient(135deg,#40E0D0,#8F5BFF);
  color:white;
  padding:10px 18px;
  border-radius:16px;
  text-decoration:none;
  font-weight:bold;
  transition:all 0.2s;
}
#back-btn:hover { transform:scale(1.1); }

/* ----- Announcement box ----- */
.announcement-box { margin:40px auto; width:90%; max-width:720px; padding:16px 24px; border-radius:16px; background: rgba(64,224,208,0.15); border:2px solid #40E0D0; text-align:left; color:white; box-shadow:0 0 20px #40E0D0,0 0 40px #8F5BFF; }
.announcement-box h2 { text-align:center; font-size:1.6rem; margin-bottom:12px; }
.announcement-box ul { list-style:none; padding:0; margin:0; max-height:150px; overflow-y:auto; }
.announcement-box li { margin-bottom:6px; font-size:1rem; }

/* ----- Footer ----- */
footer { margin:40px 0; font-size:0.75rem; opacity:0.6; text-align:center; }

@media(max-width:500px){
  #wallet-dashboard { width:90%; }
}
</style>
</head>
<body>

<div id="top-bar">
  <div>Swapey DEX History</div>
  <div id="phantom-btn" class="disconnected" onclick="togglePhantom()">
    <img src="phantom-logo.png" alt="Phantom"/>
  </div>
</div>

<div id="wallet-dashboard">
  <div id="wallet-address"></div>
  <div id="wallet-sol"></div>
  <div id="wallet-tokens"></div>
</div>

<header>
  <h1>Swapey DEX Wallet History</h1>
  <p>See your connected Phantom wallet and token balances.</p>
  <a href="index.html" id="back-btn">‚Üê Back to Home</a>
</header>

<div class="announcement-box">
  <h2>Live Crypto News</h2>
  <ul id="crypto-news">
    <li>BTC surged 5% in the last hour!</li>
    <li>ETH staking rewards increase announced</li>
    <li>SOL network upgrade soon</li>
    <li>New token listing on Swapey DEX!</li>
  </ul>
</div>

<footer>
  Swapey is decentralized. Use at your own risk.
</footer>

<script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@solana/spl-token-registry@0.2.10/dist/index.iife.js"></script>
<script>
let connection, pubKey;
const phantomBtn=document.getElementById("phantom-btn");

async function togglePhantom(){
  if(window.solana && window.solana.isPhantom){
    if(!pubKey){
      const resp=await window.solana.connect();
      pubKey=resp.publicKey;
      phantomBtn.classList.remove("disconnected");
      phantomBtn.classList.add("connected");
      updateWalletInfo();
    } else {
      await window.solana.disconnect();
      pubKey=null;
      phantomBtn.classList.remove("connected");
      phantomBtn.classList.add("disconnected");
      document.getElementById("wallet-address").innerHTML="";
      document.getElementById("wallet-sol").innerHTML="";
      document.getElementById("wallet-tokens").innerHTML="";
    }
  } else alert("Phantom not detected");
}

async function updateWalletInfo(){
  if(!pubKey) return;
  connection=new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
  const solBalance=await connection.getBalance(pubKey);
  const addressStr=pubKey.toString();
  const masked=addressStr.slice(0,3)+"*****"+addressStr.slice(-3);
  document.getElementById("wallet-address").innerText="Address: "+masked;
  document.getElementById("wallet-sol").innerText="SOL Balance: "+(solBalance/1e9).toFixed(4);

  const tokenList = await new TokenListProvider().resolve();
  const tokenMap = tokenList.filter(t=>t.chainId===101).slice(0,100); 
  const walletTokensDiv=document.getElementById("wallet-tokens");
  walletTokensDiv.innerHTML="<ul>";
  for(const token of tokenMap){
    try{
      const tokenPubKey = new solanaWeb3.PublicKey(token.address);
      const tokenAccounts = await connection.getTokenAccountsByOwner(pubKey,{mint:tokenPubKey});
      let balance = 0;
      if(tokenAccounts.value.length>0){
        const accountInfo = await connection.getParsedAccountInfo(tokenAccounts.value[0].pubkey);
        balance = accountInfo.value.data.parsed.info.tokenAmount.uiAmount || 0;
      }
      walletTokensDiv.innerHTML+=`<li>${token.symbol}: ${balance}</li>`;
    } catch(e){ console.error(token.symbol,e); }
  }
  walletTokensDiv.innerHTML+="</ul>";
}

// Ticker
async function updateTicker(){
  const resp=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd");
  const data=await resp.json();
  document.getElementById("crypto-news").innerHTML = `
    <li>BTC: $${data.bitcoin.usd}</li>
    <li>ETH: $${data.ethereum.usd}</li>
    <li>SOL: $${data.solana.usd}</li>
  `;
}
updateTicker();
setInterval(updateTicker,10000);
</script>

</body>
</html>
