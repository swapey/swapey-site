<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Swapey DEX | History</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  font-family:'Luckiest Guy', cursive;
  color:white;
  text-align:center;
  background:#16002d;
  overflow-x:hidden;
}

/* ----- Top-left Home ----- */
#top-left {
  position: fixed;
  top:32px;
  left:12px;
  z-index:10;
}
#top-left .btn-home {
  background: linear-gradient(135deg,#40E0D0,#8F5BFF);
  color:white;
  padding:10px 18px;
  border-radius:16px;
  text-decoration:none;
  font-weight:bold;
  font-family:'Luckiest Guy', cursive;
  transition: all 0.2s;
}
#top-left .btn-home:hover { transform: scale(1.1); }

/* ----- Top-right Phantom ----- */
#top-right {
  position: fixed;
  top:32px;
  right:12px;
  display:flex;
  align-items:center;
  gap:10px;
  z-index:10;
}
#top-right img {
  width:40px;
  cursor:pointer;
  border:3px solid red; /* rouge = déconnecté */
  border-radius:50%;
  transition: all 0.2s ease;
}
#top-right img.connected {
  border-color:lime; /* vert = connecté */
}

/* ----- Wallet dashboard ----- */
#wallet-dashboard {
  position: fixed;
  top:80px;
  right:12px;
  width:260px;
  padding:12px;
  background: rgba(64,224,208,0.1);
  border-radius:16px;
  text-align:left;
  box-shadow:0 0 20px #40E0D0,0 0 40px #8F5BFF;
  font-size:0.9rem;
  z-index:10;
}
#wallet-balance { margin-bottom:6px; }
#wallet-tokens { max-height:280px; overflow-y:auto; }

/* ----- Header ----- */
header {
  padding:100px 20px 20px;
}
header img {
  width:520px;
  max-width:92%;
  margin-bottom:20px;
}
h1 { font-size:3rem; margin:10px 0; }

/* ----- History content ----- */
.history-box {
  margin:40px auto;
  width:90%;
  max-width:720px;
  padding:16px 24px;
  border-radius:16px;
  background: rgba(64,224,208,0.15);
  border:2px solid #40E0D0;
  text-align:left;
  color:white;
  box-shadow:0 0 20px #40E0D0,0 0 40px #8F5BFF;
}
.history-box h2 {
  text-align:center;
  font-size:1.6rem;
  margin-bottom:12px;
}
.history-box ul {
  list-style:none;
  padding:0;
  margin:0;
}
.history-box li {
  margin-bottom:8px;
  font-size:1rem;
}

/* ----- Footer ----- */
footer {
  margin:40px 0;
  font-size:0.75rem;
  opacity:0.6;
  text-align:center;
}
</style>
</head>
<body>

<!-- Home button -->
<div id="top-left">
  <a href="index.html" class="btn-home">Home</a>
</div>

<!-- Phantom Wallet -->
<div id="top-right">
  <img src="phantom-logo.png" alt="Phantom" id="phantom-logo" onclick="connectPhantom()"/>
</div>

<div id="wallet-dashboard">
  <div id="wallet-balance"></div>
  <div id="wallet-tokens"></div>
</div>

<header>
  <img src="swapey-logo.png" alt="Swapey Logo"/>
  <h1>Swapey DEX History</h1>
</header>

<div class="history-box">
  <h2>Recent Swap Activity</h2>
  <ul id="swap-history">
    <li>No swaps yet.</li>
  </ul>
</div>

<footer>
  Swapey is decentralized. Use at your own risk.
</footer>

<script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@solana/spl-token-registry@0.2.10/dist/index.iife.js"></script>
<script>
let phantomConnected = false;

// Phantom Wallet
async function connectPhantom(){
  const img=document.getElementById("phantom-logo");
  if(window.solana && window.solana.isPhantom){
    if(!phantomConnected){
      const resp=await window.solana.connect();
      const pubKey=resp.publicKey;
      img.classList.add("connected");
      phantomConnected=true;

      const connection=new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
      const solBalance=await connection.getBalance(pubKey);
      document.getElementById("wallet-balance").innerText="SOL: "+(solBalance/1e9).toFixed(4);

      const tokenList = await new TokenListProvider().resolve();
      const tokenMap = tokenList.filter(t=>t.chainId===101);
      const walletTokensDiv=document.getElementById("wallet-tokens");
      walletTokensDiv.innerHTML="<ul>";
      for(const token of tokenMap){
        try{
          const tokenPubKey = new solanaWeb3.PublicKey(token.address);
          const tokenAccounts = await connection.getTokenAccountsByOwner(pubKey,{mint:tokenPubKey});
          let balance = 0;
          if(tokenAccounts.value.length>0){
            const accountInfo = await connection.getParsedAccountInfo(tokenAccounts.value[0].pubkey);
            balance = accountInfo.value.data.parsed.info.tokenAmount.uiAmount || 0;
          }
          walletTokensDiv.innerHTML+=`<li>${token.symbol}: ${balance}</li>`;
        } catch(e){ console.error(token.symbol,e); }
      }
      walletTokensDiv.innerHTML+="</ul>";
    } else {
      // disconnect
      img.classList.remove("connected");
      phantomConnected=false;
      document.getElementById("wallet-balance").innerText="";
      document.getElementById("wallet-tokens").innerHTML="";
      await window.solana.disconnect();
    }
  } else {
    alert("Phantom not detected");
  }
}
</script>
</body>
</html>
