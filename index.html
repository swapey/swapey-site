<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Swapey DEX | Quick Swap</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
<style>
body { margin:0; background:#16002d; font-family:'Luckiest Guy', cursive; color:white; text-align:center; }
#top-right { position: fixed; top:12px; right:12px; display:flex; align-items:center; gap:10px; z-index:10; }
#top-right img { width:40px; cursor:pointer; transition: transform 0.2s ease; }
#top-right img:hover { transform: scale(1.2) rotate(-10deg); }
#top-right a.btn-history { background: linear-gradient(135deg,#40E0D0,#8F5BFF); color:white; padding:10px 18px; border-radius:16px; text-decoration:none; font-weight:bold; transition:all 0.2s; }
#top-right a.btn-history:hover { transform: scale(1.1); }
#top-right small { display:block; font-size:0.65rem; opacity:0.7; }

#wallet-dashboard { position: fixed; top:70px; right:12px; width:280px; padding:12px; background: rgba(64,224,208,0.1); border-radius:16px; text-align:left; box-shadow:0 0 20px #40E0D0,0 0 40px #8F5BFF; font-family:'Luckiest Guy', cursive; font-size:0.9rem; }
#wallet-status { font-weight:bold; margin-bottom:6px; }
#wallet-balance { margin-bottom:6px; }
#wallet-tokens { max-height:280px; overflow-y:auto; }

header { padding:60px 20px 20px; }
header img { width:520px; max-width:92%; margin-bottom:20px; }
h1 { font-size:3.4rem; margin:10px 0; }
p { font-size:1.2rem; color:#ffffffcc; max-width:720px; margin:auto; }

#event-countdown { font-size:1.5rem; margin:20px 0; color:#40E0D0; font-weight:bold; }

.swap-form { margin:40px auto; text-align:center; }
.swap-card {
  background: linear-gradient(135deg,#2a004f,#4d00a0);
  border-radius: 24px;
  padding: 20px;
  width: 380px;
  max-width:95%;
  margin:auto;
  box-shadow:0 0 20px #40E0D0,0 0 40px #8F5BFF;
}
.swap-header { font-size:1.8rem; font-weight:bold; margin-bottom:12px; color:#40E0D0; text-shadow:0 0 4px #8F5BFF; }
.swap-row { margin:8px 0; display:flex; gap:8px; }
.swap-row select, .swap-row input { flex:1; padding:10px; border-radius:12px; border:none; font-family:'Luckiest Guy', cursive; font-size:1rem; text-align:center; }
.swap-row input { background:#fff; color:#000; }
.swap-row input::placeholder { color:gold; font-weight:bold; }

#swapey-button {
  margin-top:12px;
  background:none;
  border:none;
  font-size:2.4rem;
  color:white;
  text-shadow:0 0 8px #40E0D0,0 0 16px #8F5BFF;
  cursor:pointer;
  transition: all 0.3s ease;
}
#swapey-button:hover { transform: scale(1.1) rotate(-2deg); text-shadow:0 0 12px #40E0D0,0 0 24px #8F5BFF; }

#confirm { position:fixed; top:20px; left:50%; transform:translateX(-50%); background: linear-gradient(135deg,#40E0D0,#8F5BFF); padding:16px 32px; border-radius:16px; font-weight:bold; color:black; font-size:1.2rem; display:none; box-shadow:0 0 25px #40E0D0,0 0 50px #8F5BFF; animation: flash 0.5s ease-in-out; }
@keyframes flash { 0% { transform: translateX(-50%) scale(0.8); opacity:0; } 50% { transform: translateX(-50%) scale(1.1); opacity:1; } 100% { transform: translateX(-50%) scale(1); opacity:1; } }

.announcement-box { margin:40px auto; width:90%; max-width:720px; padding:16px 24px; border-radius:16px; background: rgba(64,224,208,0.15); border:2px solid #40E0D0; text-align:left; color:white; box-shadow:0 0 20px #40E0D0,0 0 40px #8F5BFF; }
.announcement-box h2 { text-align:center; font-size:1.6rem; margin-bottom:12px; }
.announcement-box ul { list-style:none; padding:0; margin:0; max-height:150px; overflow-y:auto; }
.announcement-box li { margin-bottom:6px; font-size:1rem; }

footer { margin:40px 0; font-size:0.75rem; opacity:0.6; text-align:center; }
</style>
</head>
<body>

<div id="top-right">
  <img src="metamask-fox.png" onclick="connectMetaMask()" alt="MetaMask"/>
  <img src="phantom-logo.png" onclick="connectPhantom()" alt="Phantom"/>
  <a href="history.html" class="btn-history">History</a>
  <small>Polygon Network only</small>
</div>

<div id="wallet-dashboard">
  <div id="wallet-status">Not connected</div>
  <div id="wallet-balance"></div>
  <div id="wallet-tokens"></div>
</div>

<header>
  <img src="swapey-logo.png" alt="Swapey Logo"/>
  <h1>Swapey DEX</h1>
  <p>Swap hundreds of tokens instantly on Polygon using Swapey interface.</p>
</header>

<div id="event-countdown">
  Announcement in: <span id="countdown">Loading...</span>
</div>

<div class="swap-form">
  <div class="swap-card">
    <div class="swap-header">Swap Tokens</div>
    <div class="swap-row">
      <select id="token-from"></select>
      <input type="number" id="amount" placeholder="Enter amount"/>
    </div>
    <div class="swap-row">
      <select id="token-to"></select>
    </div>
    <button id="swapey-button" onclick="swapTokens()">Swapey</button>
  </div>
</div>

<div id="confirm">âœ… Swap Successful!</div>

<div class="announcement-box">
  <h2>Live Crypto News</h2>
  <ul id="crypto-news">
    <li>BTC surged 5% in the last hour!</li>
    <li>ETH staking rewards increase announced</li>
    <li>Polygon network upgrade soon</li>
    <li>New token listing on Swapey DEX!</li>
  </ul>
</div>

<footer>
  Swapey is decentralized. Use at your own risk.
</footer>

<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
<script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@solana/spl-token-registry@0.2.10/dist/index.iife.js"></script>
<script>
// Polygon top tokens
const polygonTokens=[
  {symbol:"MATIC", addr:"0x0000000000000000000000000000000000001010"},
  {symbol:"USDC", addr:"0x2791bca1f2de4661ed88a30c99a7a9449aa84174"},
  {symbol:"USDT", addr:"0xc2132d05d31c914a87c6611c10748aeb04b58e8f"},
  {symbol:"DAI", addr:"0x8f3cf7ad23cd3cadbd9735aff958023239c6a063"},
  {symbol:"WETH", addr:"0x7ceb23fd6bc0add59e62ac25578270cff1b9f619"},
  {symbol:"WBTC", addr:"0x1bfd67037b42cf73acf2047067bd4f2c47d9bfd6"},
  {symbol:"AAVE", addr:"0xd6df932a45c0f255f85145f286ea0b292b21c90b"},
  {symbol:"LINK", addr:"0x53e0bca35ec356bd5dddfebbd1fc0fd03fabad39"},
  {symbol:"SUSHI", addr:"0x0b3f868e0be5597d5db7feb59e1cadbb0fdda50a"},
  {symbol:"UNI", addr:"0xb33eaad8d922b1083446dc23f610c2567fb5180f"}
];

let provider, signer;

// Populate selects
function populateTokenSelects(){
  const fromSelect=document.getElementById("token-from");
  const toSelect=document.getElementById("token-to");
  fromSelect.innerHTML=""; toSelect.innerHTML="";
  polygonTokens.forEach(t=>{
    fromSelect.innerHTML+=`<option value="${t.addr}">${t.symbol}</option>`;
    toSelect.innerHTML+=`<option value="${t.addr}">${t.symbol}</option>`;
  });
}
populateTokenSelects();

// Update balances MetaMask
async function updateTokenBalances(address){
  const walletTokensDiv=document.getElementById("wallet-tokens");
  walletTokensDiv.innerHTML="<ul>";
  for(const token of polygonTokens){
    try{
      let balance="0";
      if(token.symbol==="MATIC"){
        const bal=await provider.getBalance(address);
        balance=ethers.utils.formatEther(bal);
      } else {
        const contract=new ethers.Contract(token.addr,["function balanceOf(address) view returns (uint256)","function decimals() view returns (uint8)"],provider);
        const decimals=await contract.decimals();
        const bal=await contract.balanceOf(address);
        balance=ethers.utils.formatUnits(bal,decimals);
      }
      walletTokensDiv.innerHTML+=`<li>${token.symbol}: ${parseFloat(balance).toFixed(4)}</li>`;
    } catch(e){ console.error(token.symbol,e); }
  }
  walletTokensDiv.innerHTML+="</ul>";
}

// Connect MetaMask
async function connectMetaMask(){
  if(window.ethereum){
    provider=new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts",[]);
    signer=provider.getSigner();
    const address=await signer.getAddress();
    document.getElementById("wallet-status").innerText="MetaMask: "+address.slice(0,6)+"â€¦"+address.slice(-4);
    const balance=await provider.getBalance(address);
    document.getElementById("wallet-balance").innerText="MATIC: "+ethers.utils.formatEther(balance);
    await updateTokenBalances(address);
  } else alert("MetaMask not detected");
}

// Connect Phantom
async function connectPhantom(){
  if(window.solana && window.solana.isPhantom){
    const resp=await window.solana.connect();
    const pubKey=resp.publicKey;
    document.getElementById("wallet-status").innerText="Phantom: "+pubKey.toString().slice(0,4)+"â€¦"+pubKey.toString().slice(-4);

    const connection=new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
    const solBalance=await connection.getBalance(pubKey);
    document.getElementById("wallet-balance").innerText="SOL: "+(solBalance/1e9).toFixed(4);

    const tokenList = await new TokenListProvider().resolve();
    const tokenMap = tokenList.filter(t=>t.chainId===101);
    const walletTokensDiv=document.getElementById("wallet-tokens");
    walletTokensDiv.innerHTML="<ul>";
    for(const token of tokenMap){
      try{
        const tokenPubKey = new solanaWeb3.PublicKey(token.address);
        const tokenAccount = await connection.getTokenAccountsByOwner(pubKey,{mint:tokenPubKey});
        let balance="0";
        if(tokenAccount.value.length>0){
          const accountInfo = await connection.getParsedAccountInfo(tokenAccount.value[0].pubkey);
          balance = accountInfo.value.data.parsed.info.tokenAmount.uiAmount || 0;
        }
        walletTokensDiv.innerHTML+=`<li>${token.symbol}: ${balance}</li>`;
      } catch(e){ console.error(token.symbol,e); }
    }
    walletTokensDiv.innerHTML+="</ul>";
  } else alert("Phantom not detected");
}

// Countdown
const eventDate=new Date("2026-01-26T20:00:00");
function updateCountdown(){
  const now=new Date();
  const diff=eventDate-now;
  if(diff<=0){ document.getElementById("countdown").innerText="The announcement is live! ðŸŽ‰"; clearInterval(countdownInterval); return; }
  const days=Math.floor(diff/(1000*60*60*24));
  const hours=Math.floor((diff/(1000*60*60))%24);
  const minutes=Math.floor((diff/(1000*60))%60);
  const seconds=Math.floor((diff/1000)%60);
  document.getElementById("countdown").innerText=`${days}d ${hours}h ${minutes}m ${seconds}s`;
}
updateCountdown();
const countdownInterval=setInterval(updateCountdown,1000);

// Swapey swap placeholder
async function swapTokens(){
  if(!signer){ alert("Connect wallet first"); return; }
  const fromAddr=document.getElementById("token-from").value;
  const toAddr=document.getElementById("token-to").value;
  const amount=document.getElementById("amount").value;
  if(!amount||amount<=0){ alert("Enter a valid amount"); return; }

  const confirm=document.getElementById("confirm");
  confirm.style.display="block";
  setTimeout(()=>{confirm.style.display="none";},3500);

  const address=await signer.getAddress();
  await updateTokenBalances(address);
}
</script>
</body>
</html>
