<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Swapey DEX â€” Jupiter Powered</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">

<style>
body {
  margin:0;
  font-family:'Luckiest Guy', cursive;
  background:#12001f;
  color:white;
  text-align:center;
  overflow-x:hidden;
}

/* ===== TOP BAR ===== */
#top-bar {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  background:#1a0033;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 16px;            /* ðŸ”§ rÃ©duit et Ã©quilibrÃ© */
  box-sizing:border-box;       /* ðŸ”‘ FIX IMPORTANT */
  z-index:10;
}

#left-top {
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}

#network {
  background:none;
  border:2px solid #40E0D0;
  color:white;
  border-radius:10px;
  padding:4px 8px;
  cursor:pointer;
  font-family:'Luckiest Guy', cursive;
}

#wallet-display {
  font-size:0.75rem;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* ===== PHANTOM BUTTON ===== */
#phantom-btn {
  flex-shrink:0;               /* ðŸ”‘ empÃªche la coupe */
  width:44px;
  height:44px;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  margin-right:4px;            /* ðŸ”§ pousse vers la gauche */
}

#phantom-btn.connected {
  box-shadow:0 0 0 3px #00ff80;
}
#phantom-btn.disconnected {
  box-shadow:0 0 0 3px #ff3b3b;
}

#phantom-btn img {
  width:28px;
  height:28px;
}

/* ===== CONTAINER ===== */
.container {
  max-width:420px;
  margin:90px auto 0;
  padding:0 16px;
}

/* ===== HEADER ===== */
header img {
  width:260px;
}
h1 {
  font-size:2.6rem;
}
p {
  opacity:0.8;
}

/* ===== SWAP BOX ===== */
.swap-box {
  margin-top:30px;
  background:linear-gradient(135deg,#2a004f,#4d00a0);
  padding:22px;
  border-radius:26px;
  box-shadow:0 0 25px #40E0D0,0 0 45px #8F5BFF;
}

.swap-box select,
.swap-box input {
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:14px;
  border:none;
  font-family:'Luckiest Guy', cursive;
  text-align:center;
}

.swap-box input {
  color:black;
}

.row {
  display:flex;
  justify-content:space-between;
  font-size:0.75rem;
  opacity:0.9;
}

#swap-btn {
  margin-top:14px;
  font-size:2.4rem;
  background:none;
  border:none;
  color:white;
  cursor:pointer;
  text-shadow:0 0 10px #40E0D0;
}

/* ===== HISTORY ===== */
#history {
  margin-top:30px;
  font-size:0.7rem;
  text-align:left;
  background:rgba(255,255,255,0.05);
  padding:12px;
  border-radius:14px;
  max-height:160px;
  overflow:auto;
}

/* ===== FOOTER ===== */
footer {
  margin:40px 0;
  font-size:0.65rem;
  opacity:0.5;
}
</style>
</head>

<body>

<div id="top-bar">
  <div id="left-top">
    <button id="network" onclick="toggleNetwork()">Mainnet</button>
    <div id="wallet-display">Not connected</div>
  </div>

  <div id="phantom-btn" class="disconnected" onclick="connectPhantom()">
    <img src="phantom-logo.png" alt="Phantom">
  </div>
</div>

<div class="container">

<header>
  <img src="swapey-logo.png" alt="Swapey">
  <h1>Swapey DEX</h1>
  <p>Jupiter Aggregator Â· Raydium Liquidity</p>
</header>

<div class="swap-box">
  <select id="fromToken">
    <option value="SOL">SOL</option>
    <option value="USDC">USDC</option>
  </select>

  <input id="amount" type="number" placeholder="Amount">

  <div class="row">
    <span id="balance">Balance: -</span>
    <span onclick="max()" style="cursor:pointer;">MAX</span>
  </div>

  <select id="toToken">
    <option value="USDC">USDC</option>
    <option value="SOL">SOL</option>
  </select>

  <div class="row">
    <span id="route">Route: -</span>
    <span id="min">Min: -</span>
  </div>

  <button id="swap-btn" onclick="realSwap()">Swapey</button>
</div>

<div id="history"></div>

<footer>
  On-chain swaps Â· Use at your own risk
</footer>

</div>

<script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>

<script>
const JUP="https://quote-api.jup.ag/v6";
const TOKENS={
  SOL:"So11111111111111111111111111111111111111112",
  USDC:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
};

let wallet=null;
let network="mainnet-beta";

/* ===== PHANTOM ===== */
async function connectPhantom(){
  if(!window.solana) return alert("Install Phantom");
  if(!wallet){
    const r=await solana.connect();
    wallet=r.publicKey.toString();
    document.getElementById("phantom-btn").className="connected";
    document.getElementById("wallet-display").innerText=
      wallet.slice(0,4)+"*****"+wallet.slice(-4);
    loadHistory();
  } else {
    await solana.disconnect();
    wallet=null;
    document.getElementById("phantom-btn").className="disconnected";
    document.getElementById("wallet-display").innerText="Not connected";
  }
}

/* ===== NETWORK ===== */
function toggleNetwork(){
  network=network==="mainnet-beta"?"devnet":"mainnet-beta";
  document.getElementById("network").innerText=
    network==="mainnet-beta"?"Mainnet":"Devnet";
}

/* ===== MAX ===== */
async function max(){
  if(!wallet) return;
  const c=new solanaWeb3.Connection(solanaWeb3.clusterApiUrl(network));
  const bal=await c.getBalance(new solanaWeb3.PublicKey(wallet));
  document.getElementById("amount").value=(bal/1e9).toFixed(4);
}

/* ===== SWAP ===== */
async function realSwap(){
  if(!wallet) return alert("Connect wallet");

  const from=document.getElementById("fromToken").value;
  const to=document.getElementById("toToken").value;
  const amt=Math.floor(document.getElementById("amount").value*1e9);

  const q=await fetch(`${JUP}/quote?inputMint=${TOKENS[from]}&outputMint=${TOKENS[to]}&amount=${amt}&slippageBps=50`).then(r=>r.json());
  const r=q.data[0];

  document.getElementById("route").innerText=`Route: ${r.marketInfos[0].label}`;
  document.getElementById("min").innerText=`Min: ${(r.outAmount/1e9).toFixed(4)}`;

  const tx=await fetch(`${JUP}/swap`,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      route:r,
      userPublicKey:wallet,
      wrapAndUnwrapSol:true
    })
  }).then(r=>r.json());

  const raw=Uint8Array.from(atob(tx.swapTransaction),c=>c.charCodeAt(0));
  const vtx=solanaWeb3.VersionedTransaction.deserialize(raw);
  const signed=await solana.signTransaction(vtx);

  const c=new solanaWeb3.Connection(solanaWeb3.clusterApiUrl(network));
  await c.sendRawTransaction(signed.serialize());

  loadHistory();
}

/* ===== HISTORY ===== */
async function loadHistory(){
  const c=new solanaWeb3.Connection(solanaWeb3.clusterApiUrl(network));
  const sigs=await c.getSignaturesForAddress(new solanaWeb3.PublicKey(wallet),{limit:5});
  document.getElementById("history").innerHTML=
    "<b>History</b><br>"+sigs.map(s=>s.signature.slice(0,10)+"...").join("<br>");
}
</script>

</body>
</html>

